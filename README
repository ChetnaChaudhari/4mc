=== SUMMARY ===

The 4MC (4 More Compression) is a compression file format which leverages the power of LZ4 algorithm.
It's been designed to add more features to existing big data solutions like HADOOP/ElephantBird
which are currently mainly based on LZO, addressing the following major points:
 * Licensing: LZO is GPL, while LZ4 and 4mc are BSD!
 * Performances: LZ4 is world's fastest compression but not only! 
   It can achieve seamlessly much higher compression ratios by using medium/high codecs,
   thus going very near to GZIP ratios, at the price of compression CPU time only,
   since decompressors are simply going to speed up even more. 
 * Hadoop/EB: hadoop-lzo solution needs external index file to be able to split
   and process in parallel the big files, leveraging local mappers.
   4mc format has been designed for big data purpose, thus the block index is internal,
   there is no need for any external file or pre processing of input data:
   any 4mc file is ready for parallel processing.

   
=== COMPRESSION SPEED AND LEVELS ===
4mc comes with 4 compression levels, all of them leveraging the LZ4 standard library.
Both 4mc command line tool and Java HADOOP classes do provide codecs for these 4 levels.
 (1) Fast Compression: default one reaching up to 500 MB/s (LZ4 fast)
 (2) Medium Compression: half speed of fast mode, +13% ratio (LZ4 MC)
 (3) High Compression: 5x slower than fast, +25% ratio (LZ4 HC lvl 4)
 (4) Ultra Compression: 13x slower than fast, +30% ratio (LZ4 HC lvl 8) 

Bechmark with silesia on Linux CentOS 6.4 64bit - HP DL 380P Intel(R) Xeon(R) CPU E5-2697 v2 @ 2.70GHz
 Algorithm     Compression Speed     Decompression Speed      Ratio
 Fast                   390 MB/s               2200 MB/s      2.084
 Medium                 170 MB/s               2206 MB/s      2.340
 High                    69 MB/s               2436 MB/s      2.630
 Ultra                   30 MB/s               2515 MB/s      2.716

Please note that 4mc compression codecs can be also used in any stage of the M/R as compression codecs.
 
 
=== BUILD ===   
* Native: 4mc command line tool and hadoop-4mc native library for JNI codecs
  Makefile is provided for unix/linux; also cmake can be used (still needs refinement for Windows).

* Java: hadoop-4mc library for hadoop can be built with maven, using provided pom.
* Java Native: see above, make sure JAVA_HOME is set.


=== JAVA EXAMPLES ===
In java examples folder you can find 2 examples:
1) text/TestTextInput.java : this example is a perfect skeleton to start working with 4mc files on your text files
2) elephant-bird/FourMcEbProtoInputFormat.java : this adapter bridges EB frameworking letting you read 4mc files 
   containing binary protobuf objects of your own type
 

=== 4MC FILE FORMAT ===

The 4MC (4 More Compression) file format is composed by a signature, 
followed by the file header, followed by one or more compressed
blocks, followed by the index footer, followed by signature again:
SIGN + FILE HEADER + BLOCK1 + BLOCK2 + ... + BLOCKN + IDXFOOTER + SIGN

Each block consists of a block header, with several required
and optional items, followed by compressed data.

The last block is marked as an empty block of size 0 (with full header, so 12 bytes set to 0).

All data is stored in big endian format (network order).
Data is compressed by means of LZ4.
Checksums are calculated by means of XXHASH32.

Header: 

    MAGIC SIGNATURE:  4 bytes: "4MC\0"
    Version:          4 byte (1)
    Header checksum:  4 bytes

Blocks:

    Uncompressed size:  4 bytes
    Compressed size:    4 bytes, if compressed size==uncompressed size, then the data is stored as plain
    Checksum:           4 bytes, calculated on the compressed data

Footer:
    Footer size:        4 bytes
	Footer version:     4 byte (1)
    Block index offset: 4 bytes delta offset for each stored block, the delta between offset between previous file position and next block
    Footer size:        4 bytes (repeated to be able to read from end of file)
    MAGIC SIGNATURE:    4 bytes: "4MC\0"
    Footer checksum:    4 bytes (always in XXHASH32)

